<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>修改密码</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../lib/layui-v2.6.3/css/layui.css" media="all">
    <link rel="stylesheet" href="../css/public.css" media="all">
    <style>
        .layui-form-item .layui-input-company {width: auto;padding-right: 10px;line-height: 38px;}
        /* 校验提示样式，与原模板风格统一 */
        .form-tip {margin-top: 6px; color: #666; font-size: 12px; line-height: 1.5;}
        .layui-form-item .layui-form-mid {color: #ff4d4f;}
    </style>
</head>
<body>
<div class="layuimini-container">
    <div class="layuimini-main">

        <div class="layui-form layuimini-form">
            <!-- 1. 旧密码输入项（提示旧密码为QWB123456） -->
            <div class="layui-form-item">
                <label class="layui-form-label required">旧的密码</label>
                <div class="layui-input-block">
                    <input type="password" name="old_password" 
                           lay-verify="required|checkOldPwd"  <!-- 旧密码校验标识 -->
                           
                    <tip>当前旧密码固定为：QWB123456，请直接输入此值。</tip> 
                </div>
            </div>

            <!-- 2. 新密码输入项（保留字母数字校验） -->
            <div class="layui-form-item">
                <label class="layui-form-label required">新的密码</label>
                <div class="layui-input-block">
                    <input type="password" name="new_password" 
                           lay-verify="required|checkPwdFormat"  <!-- 新密码格式校验 -->
                           
                    <p class="form-tip">• 密码长度需在6-16位之间<br>• 必须包含至少1个字母（大小写均可）和1个数字<br>• 不支持特殊字符</p>
                </div>
            </div>

            <!-- 3. 确认新密码输入项（保留一致性校验） -->
            <div class="layui-form-item">
                <label class="layui-form-label required">确认新密码</label>
                <div class="layui-input-block">
                    <input type="password" name="again_password" 
                           lay-verify="required|checkConfirmPwd"  <!-- 一致性校验 -->
                           
                </div>
            </div>

            <!-- 4. 提交与取消按钮 -->
            <div class="layui-form-item">
                <div class="layui-input-block">
                    <button class="layui-btn layui-btn-normal" lay-submit lay-filter="saveBtn">确认保存</button>
                    <button type="button" class="layui-btn layui-btn-primary" id="cancelBtn">取消</button>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../lib/layui-v2.6.3/layui.js" charset="utf-8"></script>
<script src="../js/lay-config.js?v=1.0.4" charset="utf-8"></script>
<script>
    layui.use(['form','miniTab', 'layer', 'jquery'], function () {
        var form = layui.form,
            layer = layui.layer,
            miniTab = layui.miniTab,
            $ = layui.jquery;

        // -------------------------- 1. 自定义校验规则（核心调整旧密码校验值） --------------------------
        form.verify({
            // 1.1 旧密码校验：固定匹配 QWB123456
            checkOldPwd: function(value) {
                var fixedOldPwd = 'QWB123456'; // 固定旧密码值
                if (value !== fixedOldPwd) {
                    return '旧密码输入错误！当前旧密码固定为 QWB123456'; // 明确错误提示
                }
            },

            // 1.2 新密码格式校验（不变：字母+数字，6-16位）
            checkPwdFormat: function(value) {
                var pwdReg = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{6,16}$/;
                if (!pwdReg.test(value)) {
                    return '密码格式不正确！需6-16位且包含字母和数字';
                }
            },

            // 1.3 确认新密码一致性校验（不变）
            checkConfirmPwd: function(value) {
                var newPwd = $('input[name="new_password"]').val();
                if (value !== newPwd) {
                    return '两次输入的新密码不一致，请重新输入';
                }
            }
        });

        // -------------------------- 2. 监听表单提交（逻辑不变） --------------------------
        form.on('submit(saveBtn)', function (data) {
            var loadIndex = layer.load(1, {
                shade: 0.3,
                content: '正在保存密码...',
                success: function(layero) {
                    layero.find('.layui-layer-content').css('color', '#333');
                }
            });

            // 模拟后端请求
            setTimeout(function() {
                layer.close(loadIndex);
                var newPwd = data.field.new_password;
                // 保存新密码到本地存储（模拟后端更新）
                localStorage.setItem('userOldPwd', newPwd);

                layer.msg('密码修改成功！新密码已生效', {
                    icon: 6,
                    time: 1500
                }, function() {
                    miniTab.deleteCurrentByIframe(); // 关闭当前tab页
                    // 如需跳转登录页，可添加：parent.location.href = '../login.html';
                });
            }, 1200);

            return false;
        });

        // -------------------------- 3. 取消按钮逻辑（不变） --------------------------
        $('#cancelBtn').click(function() {
            miniTab.deleteCurrentByIframe();
        });

        form.render();
    });
</script>
</body>
</html>